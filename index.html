<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="Ethan Bassingthwaite" />
        <title>Jordan Valley Oregon Cemetary Project</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <!-- leaflet css  -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
        <!-- Styles for the map section-->
        <style>
            body {
                margin: 0;
                padding: 0;
            }

            #map {
                position: absolute;
                height: inherit; 
                width: 60%;
            }

            .coordinate {
                position: relative;
                bottom: 10px;
                right: 50%;
            }

            .leaflet-popup-content-wrapper {
                background-color: #f6fad1;
                color: #000000;
                border: 1px solid rgb(252, 255, 74);
                border-radius: 5px;
            }

            #maplist {
                overflow-y: auto; 
                width: 100%;
                height: 100%;  
                list-style: none; 
            }

            .container {
                position: relative;
                height: 800px;
                width: 100%;
                display: flex;
            }

            #list_container {
                position: absolute;
                margin-left: 60%;
                height: 100%;
                width: 40%;  
            }

            

            #searchInput {
                width: 96%; 
            }

            .list_text {
                display: inline-block;
                white-space: nowrap;
                overflow:hidden;
            }

            .list_image {
                height: 84px;
                display: inline-block;
                vertical-align: top;
            }
            .popup_image {
                height: 100px;
                display: inline-block;
                vertical-align: top;
            }
            .listclassformat {
                list-style: none;
                padding: 15px 130px;
                background-repeat: no-repeat;
                background-position: left center;
            }
       
        </style>
        
    </head>
    <body>
        <!-- Responsive navbar-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="#!">Webpage</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="#!">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!">About</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Header - set the background image for the header in the line below-->
        <header class="py-5 bg-image-full" style="background-image: url('images/CemBackground.JPG')">
            <div class="text-center my-5">
                <img class="img-fluid rounded-circle mb-4" src="https://dummyimage.com/150x150/6c757d/dee2e6.jpg" alt="..." />
                <h1 class="text-white fs-3 fw-bolder">Jordan Valley Oregon Cemetary Map</h1>
                <p class="text-white-50 mb-0">A project done in collaboration with the Basque Museum and Cultural Center in Boise</p>
            </div>
        </header>
        <!-- Content section-->
        <section class="py-5">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <h2>About the project</h2>
                        <p class="lead">Developed by Ethan Bassingthwaite</p>
                        <p class="mb-0">The Basque Museum previously had just a way to download the data about the cemetary and no way to truly interact with it. </p>
                    </div>
                </div>
            </div>
        </section>
        <!-- Image element - set the background image for the header in the line below-->
        <div class="container">
        
            <div id="map">
                <div class="leaflet-control coordinate"></div>
            </div>
            <div id= "list_container">
                <input type="text" id="searchInput" placeholder="Search by First or Last name...">
                <div id ="maplist">
                </div>
            </div>
        </div>
        <!-- Content section-->
        <section class="py-5">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <h2>What I learned</h2>
                        <p class="lead">Everything.</p>
                        <p class="mb-0">At the start of this project, on the very first day, I submitted a png with other pngs layered on top of it. I had never touched any of the pieces of technology that I needed to interact with before.
                            Throughout this project I learned how HTML, CSS, and Javascript interacted, how to properly use GitHub, and how web design works. I can now create more intricate pieces of code, faster, and understand code that I come across better.
                        </p>
                    </div>
                </div>
            </div>
        </section>
        <!-- Footer-->
        <footer class="py-5 bg-dark">
            <div class="container"><p class="m-0 text-center text-white">Copyright &copy; Your Website 2023</p></div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        
        <!-- leaflet js  -->
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
        <script src="PapaParse.js"></script>
        <!-- Map control script by Ethan-->
        <script>
            console.log("Wow this has updated");
            //create the map and its coordinates
            var map = L.map('map').setView([42.982521, -117.054526], 18);
            map.setMaxBounds(map.getBounds());//this makes the total map bounds just what the initial image was, easy solution and I am lazy.
            
            
        
            let markersLayer = new L.LayerGroup().addTo(map);
            const listItems = document.getElementById('maplist');
        
        
            //The place where I construct and add the map and list markers/list elements
            function addMarkers(data) {
                var myIcon = L.icon({
                    iconUrl: 'icon.png',
                    iconSize: [10, 10],
                });
        
                var textlist = [];
                var coorlist = [];
                var markerlist = [];
                var searchlist = [];
        
                //Creating the strings for the markers and lists
                for (let i = 0; i < data.length; i++) {
                    filepath = `images/${data[i]['Marker Photo']}`;
                    popuptext = `<img src="${filepath}" alt="Image" class="popup_image">`;
                    if (data[i]['Marker Photo_Military'] !== '') {
                        militaryFilepath = `images/${data[i]['Marker Photo_Military']}`;
                        popuptext += `<img src="${militaryFilepath}" alt="Image" class="popup_image">`;
                    }
                    popuptext += `<br>${data[i]['Last Name']}, ${data[i]['First Name']}<br>`;
                    if (data[i]['Maiden Name'] !== '') {
                        popuptext += `Maiden Name: ${data[i]['Maiden Name']}<br>`;
                    }
                    popuptext += `${data[i]['Date of Birth']} &ndash; ${data[i]['Date of Death']}`;
                    textlist.push(popuptext);
                    coorlist.push([data[i]['GPS 1'], data[i]['GPS 2']]);
        
                    searchtext = `${data[i]['Last Name']}, ${data[i]['First Name']} 
                                    <br> ${data[i]['Date of Birth']} &ndash; ${data[i]['Date of Death']}`
                    searchlist.push(searchtext);
                }
                
                //assigning the values to the markers
                for (let i = 0; i < coorlist.length; i++) {
                    markerlist.push(L.marker(coorlist[i], {icon: myIcon, draggable: true}));
                    markerlist[i].bindPopup(textlist[i]).openPopup().addTo(markersLayer);
                }
        
                //Code to let us align the markers with the actual graves
                markerlist.forEach(function(marker) {
                    marker.on('dragend', function() {
                        console.log(marker.getLatLng().toString());
                    });
                });
        
                //Making the list
                for (let i = 0; i < searchlist.length; i++) {
                    const li = document.createElement('li');
                    li.innerHTML = searchlist[i];
                    li.classList.add("listclassformat");
                    li.style.backgroundImage =  'url("images/' + data[i]['Marker Photo'] + '")'; 
                    li.style.backgroundSize = "120px";
                    li.addEventListener('click', function() {
                        map.setView(coorlist[i], 20);
                        markerlist[i].openPopup();
                    });
                    listItems.appendChild(li);
                }
        
            }
        
            document.addEventListener('DOMContentLoaded', function () {
                
                fetch('./CemetaryList.csv')//Getting cav values
                    .then(response => response.text())
                    .then(contents => {
                        //Parse it into an array
                        csvLines = Papa.parse(contents, {
                                header: true
                        }).data;
                        markersLayer = new L.LayerGroup().addTo(map);
                        addMarkers(csvLines);
                    })
                    .catch(error => console.error('Error fetching the file:', error));
            
                
                document.getElementById('searchInput').addEventListener('input', function () {
                    var searchTerm = this.value.toLowerCase();
                    markersLayer.clearLayers(); // Clear existing markers
                    listItems.innerHTML = ''; //Clear out the search bar
                    var filteredMarkers = csvLines.filter(function (data) {
                        return data['First Name'].toLowerCase().includes(searchTerm) ||
                               data['Last Name' ].toLowerCase().includes(searchTerm);
                    });
        
                    addMarkers(filteredMarkers);
                });
        
                
        
            });
        
        
        
            
            
        
            
            //google satellite
            googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
                maxZoom: 22, 
                //minZoom: 17, //Commented out for bugfixing
                subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
            });
            googleSat.addTo(map)
        
            var wms = L.tileLayer.wms("http://localhost:8080/geoserver/wms", {
                layers: 'geoapp:admin',
                format: 'image/png',
                transparent: true,
                attribution: "wms test",
                maxNativeZoom:19,
                maxZoom:22
            });
        
        
        
        
        
        
        
           
        </script>
    </body>
</html>



<!DOCTYPE html>
<html lang="en">



<body>
    <div class="container">
        
        <div id="map">
            <div class="leaflet-control coordinate"></div>
        </div>
        <div id= "list_container">
            <input type="text" id="searchInput" placeholder="Search by First or Last name...">
            <div id ="maplist">
            </div>
        </div>
    </div>
</body>

</html>

<!-- leaflet js  -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="PapaParse.js"></script>


